#LyX 2.2 created this file. For more info see http://www.lyx.org/
\lyxformat 508
\begin_document
\begin_header
\save_transient_properties true
\origin unavailable
\textclass book
\options openright
\use_default_options false
\master ../tesi.lyx
\maintain_unincluded_children false
\language italian
\language_package default
\inputencoding auto
\fontencoding T1
\font_roman "default" "default"
\font_sans "default" "default"
\font_typewriter "default" "default"
\font_math "auto" "auto"
\font_default_family default
\use_non_tex_fonts false
\font_sc false
\font_osf false
\font_sf_scale 100 100
\font_tt_scale 100 100
\graphics default
\default_output_format default
\output_sync 0
\bibtex_command default
\index_command default
\paperfontsize 11
\spacing single
\use_hyperref false
\papersize a4paper
\use_geometry false
\use_package amsmath 2
\use_package amssymb 2
\use_package cancel 1
\use_package esint 1
\use_package mathdots 0
\use_package mathtools 1
\use_package mhchem 0
\use_package stackrel 1
\use_package stmaryrd 1
\use_package undertilde 1
\cite_engine basic
\cite_engine_type default
\biblio_style plain
\use_bibtopic false
\use_indices false
\paperorientation portrait
\suppress_date false
\justification true
\use_refstyle 0
\index Indice
\shortcut idx
\color #008000
\end_index
\secnumdepth 3
\tocdepth 3
\paragraph_separation indent
\paragraph_indentation default
\quotes_language french
\papercolumns 1
\papersides 2
\paperpagestyle fancy
\tracking_changes false
\output_changes false
\html_math_output 0
\html_css_as_file 0
\html_be_strict false
\end_header

\begin_body

\begin_layout Standard
Per la realizzazione di OrbTail ci si è serviti di un metodo di sviluppo
 a fasi.
 La fase preliminare si è concentrata sulla definizione delle tecnologie
 impiegate: l'attenta scelta di quest'ultime è di cruciale importanza per
 minimizzare l'impatto sul processo produttivo in caso di criticitá o limitazion
i, specie nelle fasi piú avanzate del progetto.
 Al fine di mantenere lo storico dei file di progetto e controllare lo sviluppo
 delle varie funzionalitá ci si è affidati a 
\emph on
git
\emph default
, un software per il 
\emph on
controllo di versione 
\emph default
distribuito.
 
\end_layout

\begin_layout Standard
Un altro aspetto fondamentale riguarda la scelta del 
\emph on
motore grafico
\emph default
.
 Fin da subito ci si è resi conto che sviluppare senza usare motori grafici
 di terze parti avrebbe aumentato esponenzialmente il tempi di sviluppo,
 rendendo di fatto impossibile supportare tutte le piattaforme desiderate.
 Sebbene ad oggi esistono diversi motori grafici gratuiti in grado di soddifare
 la maggior parte delle esigenze, per lo sviluppo di OrbTail sono state
 valutate due sole alternative: 
\emph on
Unreal Engine 4
\emph default
 e 
\emph on
Unity 2017
\emph default
.
 Sebbene il primo di questi avrebbe garantito una resa visiva eccellente,
 il suo uso è stato rapidamente accantonato per via delle iterazioni di
 sviluppo incredibilmente lente, la mancanza di servizi di 
\emph on
matchmaking 
\emph default
e, soprattutto, delle criticitá riguardanti lo sviluppo su piattaforme 
\emph on
mobile
\emph default
 (specie in termini di prestazioni).
 Unity, d'altro canto, è sembrato fin da subito adatto agli scopi del progetto,
 specie per quanto riguarda il supporto dei dispositivi 
\emph on
mobile
\emph default
, ed in generale per la sua grande intuitivitá.
 La presenza di un servizio di 
\emph on
matchmaking 
\emph default
integrato, in grado di gestire tutte le piattaforme contemporaneamente,
 ne ha consolidato l'adozione.
\end_layout

\begin_layout Section
Unity
\end_layout

\begin_layout Standard
Unity è un motore grafico sviluppato da 
\emph on
Unity Technologies
\emph default
 che consente di sviluppare giochi multipiattaforma su tutte le pattaforme
 
\emph on
mobile
\emph default
, 
\emph on
console 
\emph default
e 
\emph on
desktop
\emph default
.
 La presenza di una versione gratuita, unita ad un elevato grado di intuitivitá,
 ne ha garantito la rapida affermazione da parte di sviluppatori 
\emph on
indipendenti
\emph default
 e non.
 Questo motore è caratterizzato da paradigmi di sviluppo molto chiari, il
 che lo rende tanto adatto agli sviluppatori alla prime armi quanto ai piú
 esperti.
 Il 
\emph on
pattern architetturale
\emph default
 principale, rappresentato dal
\emph on
l'entity-component
\emph default
, consiste nell'implementare funzionalitá autoconclusive all'interno di
 
\emph on
componenti 
\emph default
indipendenti ed usare i 
\emph on
game object 
\emph default
(termine usato da Unity per descrivere le 
\emph on
entitá
\emph default
)
\emph on
 
\emph default
come aggregatori di quest'ultimi al fine di modellare comportamenti piú
 complessi.
 Questo paradigma è stato migliorato nella versione del motore del 2018,
 introducendo il concetto di 
\emph on
system
\emph default
.
 Secondo questa variante, i componenti espongono solo dei dati e le logiche
 sono implementate all'interno dei 
\emph on
sistemi
\emph default
, garantendo un disaccoppiamento ancora piú forte tra le varie componenti
 del gioco.
 Unity consente di implementare le logiche di gioco tramite script 
\emph on
C# 
\emph default
o 
\emph on
Javascript 
\emph default
e 
\emph on
shader 
\emph default
personalizzati tramite il linguaggio CG.
 L'assenza completa di codice nativo, ad eccezione del 
\emph on
core
\begin_inset Foot
status collapsed

\begin_layout Plain Layout
Il 
\emph on
core 
\emph default
di un motore grafico è il modulo software di piú basso livello.
 Esso si occupa di astrarre le funzionalitá specifiche di ciascuna piattaforma
 e di dettare il flusso di esecuzione di tutti gli altri sottosistemi, quali
 il renderer, il motore fisico, la logica di gioco e la gestione della memoria.
\end_layout

\end_inset


\emph default
, rende le iterazioni di sviluppo incredibilmente veloci in quanto non esiste
 un processo apposito di compilazione.
\end_layout

\begin_layout Standard
La limitazione maggiore di questo engine risiede nel fatto che il suo 
\emph on
core 
\emph default
è completamente 
\emph on
closed-source 
\emph default
(a meno di non pagare per ottenerne l'accesso) e ció impedisce agli sviluppatori
 di poterne analizzare il flusso di esecuzione, rendendo particolarmente
 difficile il processo di 
\emph on
debugging.
 
\emph default
Questa limitazione è stata mitigata durante il primo trimestre del 2018,
 quando Unity Technologies ne ha reso pubblico il codice sorgente C# su
 
\emph on
bitbucket
\begin_inset CommandInset citation
LatexCommand cite
key "UnityCSharp"

\end_inset

.
 
\emph default
Nonostante il rilascio del codice sia un notevole passo avanti, permane
 ancora l'impossibilitá di modificare il codice del motore per adattarlo
 meglio alle proprie esigenze e ció richiede talvolta l'impiego di soluzioni
 temporanee o alternative.
\end_layout

\begin_layout Standard
Per lo sviluppo di OrbTail sono state usate prevalentemente funzionalitá
 di base legate al 3D, al motore fisico, alla gestione delle scene e delle
 funzionalitá di rete.
 L'uso di funzionalitá generiche ha permesso di evitare tutte le problematiche
 legate ai sistemi piú specifici, quali gestione del 2D e delle 
\emph on
nav mesh 
\begin_inset Foot
status collapsed

\begin_layout Plain Layout
Le 
\emph on
nav-mesh 
\emph default
(in italiano 
\begin_inset Quotes fld
\end_inset

mesh di navigazione
\begin_inset Quotes frd
\end_inset

) sono delle superfici poligonali solitamente usate dal sistema di 
\emph on
intelligenza artificiale 
\emph default
per determinare il percorso ottimo (o subottimo) tra due punti nello spazio.
\end_layout

\end_inset

, 
\emph default
le quali si sono talvolta dimostrate inaffidabili, limitate o afflitte da
 bug nascosti.
 L'intero codice sorgente del gioco è stato sviluppato in C#, utilizzando
 il paradigma 
\emph on
entity-component
\emph default
.
 L'integrazione del pattern 
\emph on
entity-component-system 
\emph default
è stata evitata in quanto questi risultava ancora in fase sperimentale e
 per via del fatto che lo sviluppo del gioco era giá in fase avanzata e
 si voleva evitare di correre 
\emph on
rischi
\emph default
 inutili.
\end_layout

\begin_layout Subsection
Plug-in
\end_layout

\begin_layout Standard
Unity mette a disposizione un gran quantitativo di 
\emph on
plug-in 
\emph default
esterni al fine di aumentare la resa dei giochi, semplificare il processo
 di sviluppo o aggiungere nuove funzionalitá.
 Per lo sviluppo di OrbTail è stato deciso di utilizzarne uno solo
\emph on
 
\emph default
dal nome 
\emph on
iTween
\begin_inset CommandInset citation
LatexCommand cite
key "iTween"

\end_inset

.
 
\emph default
Questo plug-in gratuito è usato per gestire in maniera semplice ed automatica
 il processo di 
\emph on
tweening
\emph default
, ovvero l'interpolazione automatica di valori in un certo periodo di tempo
 attraverso il sistema di 
\emph on
coroutine 
\emph default
di C#.
 Il plug-in è stato utilizzato principalmente per aggiungere animazioni
 agli elementi dell'interfaccia grafica ed in misura molto minore per gli
 elementi di gioco 3D.
 L'uso di questo sistema ha permesso di risparmiare un notevole quantitativo
 di tempo, garantendo una resa visiva molto buona.
 Quest'ultimo si presenta come un unico file monolitico che puó essere integrato
 nel progetto e non richiede alcuna forma di configurazione.
\end_layout

\begin_layout Section
Meccaniche di base
\end_layout

\begin_layout Standard
La prima fase dello sviluppo di OrbTail si concentra sulla definizione dell'arch
itettura generale del gioco ed in particolar modo delle meccaniche di base.
 Quest'ultime sono condivise tra tutte le modalitá e livelli e pertanto
 sono state pensate per essere completamente indipendenti da essi.
 Tra le meccaniche di base troviamo la gestione della gravità, del sistema
 di controllo dei veicoli, degli oggetti collezionabili, degli scontri e
 dei potenziamenti (Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:VehicleComponents"

\end_inset

)
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename C:/Users/raffa/Documents/Repo/OrbTail/Doc/Tesi/img/OrbTailShip.png
	lyxscale 20
	width 14cm

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset Argument 1
status open

\begin_layout Plain Layout
Struttura dei veicoli
\end_layout

\end_inset


\begin_inset CommandInset label
LatexCommand label
name "fig:VehicleComponents"

\end_inset

Struttura dei veicoli
\end_layout

\end_inset


\end_layout

\end_inset

.
 
\end_layout

\begin_layout Subsection
Gestione della gravità
\end_layout

\begin_layout Standard
I livelli offerti dal gioco sono caratterizzati da topologie profondamente
 diverse, il che rende impossibile utilizzare la gravità automatica fornita
 dal motore fisico di Unity per far fluttuare gli oggetti su di essi.
 Durante una prima iterazione ci si è affidati al sistema di 
\emph on
raycasting 
\begin_inset Foot
status collapsed

\begin_layout Plain Layout
Il 
\emph on
raycasting 
\emph default
è una tecnica che consente di determinare le intersezioni tra un raggio
 descritto da un punto inziale ed una direzione ed una o piú superfici poligonal
i.
\end_layout

\end_inset

 
\emph default
al fine di individuare un punto sulla superficie del livello da usare come
 base per il calcolo della gravità, usando l'asse longitudinale di ciascun
 oggetto come direzione.
 Sebbene l'uso di questa tecnica
\emph on
 
\emph default
permette di scrivere un codice di gestione unico che si adatta a tutte le
 topologie, determinare la direzione del raggio usando solo l'orientamento
 dell'oggetto puó generare risultati ambigui o imprevedibili.
 Queste problematiche sono esacerbate da rapidi cambi di direzione a seguito
 di esplosioni o durante il normale 
\emph on
rollio 
\emph default
degli oggetti lungo la superficie del livello.
 Per risolvere questa ambiguitá ci si è affidati ad una descrizione 
\emph on
analitica 
\emph default
della forza di gravità per ciascuna delle topologie supportate.
 Il 
\emph on
campo gravitazionale
\emph default
 cosí descritto consente di ottenere una direzione non ambigua in cui effettuare
 il 
\emph on
raycasting
\emph default
 per ogni punto dello spazio.
 Una volta individuato il punto sulla superficie, una semplice simulazione
 di un 
\emph on
moto oscillatorio smorzato 
\emph default
permette di modellare lo stazionamento degli oggetti sull'arena.
\end_layout

\begin_layout Standard
La soluzione adottata prevede l'uso di due elementi principali: un componente
 base 
\emph on
Gravity Field, 
\emph default
da cui derivano le diverse descrizioni dei campi di gravità supportati,
\emph on
 
\emph default
e il 
\emph on
Floating Object 
\emph default
che, assegnato agli oggetti di gioco, consente loro di fluttuare sull'arena
 (Fig.
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:OrbTailGravity"

\end_inset

).
\begin_inset Float figure
placement !h
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\noindent
\align center
\begin_inset Graphics
	filename C:/Users/raffa/Documents/Repo/OrbTail/Doc/Tesi/img/OrbTailGravity.png
	lyxscale 20
	height 7cm

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset Argument 1
status open

\begin_layout Plain Layout
Gestione della gravità.
\end_layout

\end_inset


\begin_inset CommandInset label
LatexCommand label
name "fig:OrbTailGravity"

\end_inset

Gestione della gravità.
\end_layout

\end_inset


\end_layout

\end_inset

 Il primo di questi viene assegnato all'arena e consente di configurare
 sia l'intensitá della gravità e sia la distanza di stazionamento degli
 oggetti rispetto alla superficie per impedire che questi possano compenetravi.
 Il secondo si occupa di simulare lo stazionamento dell'oggetto a partire
 dalla direzione della forza di gravità.
\end_layout

\begin_layout Subsection
Sistema di controllo
\end_layout

\begin_layout Standard
Il sistema di controllo di ciascun veicolo si occupa di gestire il movimento
 di quest'ultimo all'interno dell'arena a partire dalla direzione della
 forza di gravità e dall'input dell'utente.
 Il componente 
\emph on
Movement Controller
\emph default
 determina la velocitá lineare e quella angolare del veicolo in ogni istante
 e applica opportune forze al 
\emph on
corpo rigido 
\emph default
di quest'ultimo per causarne il movimento fisico.
 La gestione del movimento non è simulata in maniera fisicamente accurata,
 bensí è affidata ad un semplice controllore 
\emph on
PID.
 
\emph default
Il sistema adoperato consente di controllare la velocitá da applicare 
\begin_inset Formula $u(t)$
\end_inset

 in funzione di quella attuale del veicolo 
\begin_inset Formula $y(t)$
\end_inset

 e di quella desiderata 
\begin_inset Formula $r(t)$
\end_inset

 usando la sola azione di controllo 
\emph on
proporzionale 
\emph default
con costante 
\begin_inset Formula $K_{p}$
\end_inset

.
 Un controllore analogo è utilizzato per gestire l'azione di sterzo e la
 velocitá angolare risultate.
 Per questa particolare implementazione le azioni 
\emph on
integrali 
\emph default
e 
\emph on
derivative 
\emph default
non sono state ritenute necessarie:
\begin_inset Formula 
\[
u(t)=K_{p}(r(t)-y(t))
\]

\end_inset


\end_layout

\begin_layout Standard
La velocitá desiderata 
\begin_inset Formula $r(t)$
\end_inset

 è determinata dal valore massimo di 
\emph on
velocitá 
\emph default
del veicolo 
\begin_inset Formula $r_{max}>0$
\end_inset

 e dall'input dell'utente 
\begin_inset Formula $r_{in}\in[-1;+1]$
\end_inset

.
 Il termine proporzionale 
\begin_inset Formula $K_{e}$
\end_inset

 è invece proporzionale al suo parametro di 
\emph on
accelerazione
\emph default
.
 L'azione di sterzo segue un principio identico ma ha costanti che dipendono
 dalla 
\emph on
manovrabilitá 
\emph default
del veicolo (vedi 
\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:Veicoli"

\end_inset

):
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
r(t)=r_{max}\cdot r_{in}
\]

\end_inset


\end_layout

\begin_layout Standard
La direzione di accelerazione è ricavata tramite il componente 
\emph on
Floating Object
\emph default
 in funzione della tangente del campo di gravità e della rotazione del veicolo,
 e ció impedisce che quest'ultimo possa percorrere la superficie del livello
 passandovici attraverso.
\end_layout

\begin_layout Subsection
Gestione dei collezionabili
\end_layout

\begin_layout Standard
La gestione della collezione degli elementi di gioco è affidata a tre componenti
 fondamentali (Fig.
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:OrbTailOrb"

\end_inset

).
\begin_inset Float figure
placement !h
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\noindent
\align center
\begin_inset Graphics
	filename C:/Users/raffa/Documents/Repo/OrbTail/Doc/Tesi/img/OrbTailOrbs.png
	lyxscale 20
	width 12cm

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset Argument 1
status open

\begin_layout Plain Layout
Gestione dei collezionabili.
\end_layout

\end_inset


\begin_inset CommandInset label
LatexCommand label
name "fig:OrbTailOrb"

\end_inset

Gestione dei collezionabili.
\end_layout

\end_inset


\end_layout

\end_inset

 Il primo di questi, il 
\emph on
Proximity Handler
\emph default
, rappresenta un 
\emph on
volume di collisione sferico 
\emph default
attorno al veicolo il quale lancia un'opportuno evento quando un 
\emph on
orb 
\emph default
vi compenetra.
 Questo componente fa parte del 
\emph on
game object 
\emph default
che rappresenta il veicolo, assieme ad un ulteriore componente 
\emph on
Ship 
\emph default
che si preoccupa di gestire le logiche di base della coda, quali aggiungere
 o rimuoverne elementi.
 Il collegamento tra diversi 
\emph on
orb
\emph default
 è gestito attraverso un 
\emph on
vincolo fisico 
\emph default
di tipo molla, con una lunghezza massima tale per cui questi possano muoversi
 liberamente senza peró allontanarsi da quello che li precede nella coda.
 Una volta rimossi dalla coda, il vincolo fisico viene rimosso e l'
\emph on
orb 
\emph default
viene proiettato in una direzione casuale al fine di allontanarlo dal veicolo.
 Il 
\emph on
game object 
\emph default
che rappresenta ciascun 
\emph on
orb 
\emph default
usa il componente 
\emph on
Floating Object 
\emph default
al fine di fluttuare sull'arena e un altro componente, l'
\emph on
Orb Controller
\emph default
, al fine di gestire i vincoli fisici di cui sopra.
\end_layout

\begin_layout Subsection
Gestione degli scontri
\end_layout

\begin_layout Standard
Il sistema di gestione degli scontri tra veicoli è implementato attraverso
 un componente 
\emph on
Fight Controller, 
\emph default
il cui scopo è quello di rilevare gli impatti e notificare il componente
 
\emph on
Ship 
\emph default
del numero di 
\emph on
orb 
\emph default
persi come conseguenza.
 Le collisioni tra veicoli sono gestite direttamente dal motore fisico di
 Unity.
 In una prima versione ciascuno di essi aveva uno o piú 
\emph on
collisori fisici 
\emph default
che approssimavano piú o meno precisamente la loro topologia, tuttavia questo
 approccio causava comportamenti inaspettati durante la risoluzione delle
 collisioni quali veicoli che si incastravano tra loro oppure la generazione
 di impulsi fisici di entitá molto elevata che causavano la perdita di tutti
 gli 
\emph on
orb
\emph default
 disponibili.
 Al fine di non avvantaggiare nessun veicolo ed evitare queste problematiche,
 nell'ultima versione ci si è affidati all'uso di un 
\emph on
collisore sferico 
\emph default
unico che approssima la superficie del veicolo racchiudendone il modello
 grafico.
 La forma e la dimensione del collisore è identica per tutti i veicoli e
 ció garantisce un'elevata consistenza durante la risoluzione degli scontri.
 Una volta rilevata una collisione durante quest'ultimi, il motore fisico
 genera una coppia di eventi, uno per ogni componente coinvolto nell'impatto.
 Ciascun 
\emph on
Fight Controller 
\emph default
reagisce a questi eventi, determinando il numero di 
\emph on
orb 
\emph default
persi a causa dello scontro e lasciando al 
\emph on
Fight Controller 
\emph default
del veicolo avversario il compito di staccare 
\emph on
orb 
\emph default
dal proprio.
 Il numero di 
\emph on
orb 
\emph default
persi durante uno scontro dipende dalla direzione d'impatto e dall'orientamento
 dei veicoli coinvolti: uno scontro frontale deve causare un distacco di
 
\emph on
orb 
\emph default
da parte di entrambi i veicoli, laddove colpire un veicolo su una fiancata
 non deve penalizzare in alcun modo l'aggressore.
 Sia 
\begin_inset Formula $\overrightarrow{p}$
\end_inset

 la posizione del veicolo sui cui viene generato l'evento di collisione,
 
\begin_inset Formula $\overrightarrow{f}$
\end_inset

 la direzione di quest'ultimo, 
\begin_inset Formula $\overrightarrow{c}$
\end_inset

 il punto di impatto trai veicoli convolti e 
\begin_inset Formula $\overrightarrow{v_{rel}}$
\end_inset

 la velocitá relativa del veicolo rispetto all'avversario, la formula usata
 per determinare il numero di 
\emph on
danni 
\emph default
inflitti 
\begin_inset Formula $d$
\end_inset

 è la seguente:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
\overrightarrow{i_{d}}=\frac{\overrightarrow{c}-\overrightarrow{p}}{|\overrightarrow{c}-\overrightarrow{p}|}
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
i_{s}=\max(0,\overrightarrow{i_{d}}\cdot\overrightarrow{f})
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
d=|\overrightarrow{v_{rel}}|\cdot i_{s}\cdot off
\]

\end_inset


\end_layout

\begin_layout Standard
Il termine 
\begin_inset Formula $\overrightarrow{i_{d}}$
\end_inset

 rappresenta la 
\emph on
direzione relativa di impatto
\emph default
, 
\begin_inset Formula $i_{s}$
\end_inset

 è invece un fattore di scala che impedisce ai veicoli di causare danni
 al di fuori di un cono frontale.
 Il numero di 
\emph on
orb
\emph default
 
\begin_inset Formula $o_{imp}$
\end_inset

 persi dal veicolo a seguito dell'impatto è calcolato come segue:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
o_{imp}=\lfloor d\cdot def^{-1}\rfloor
\]

\end_inset


\end_layout

\begin_layout Standard
I termini 
\begin_inset Formula $off$
\end_inset

 e 
\begin_inset Formula $def$
\end_inset

 sono due parametri che identificano il potere offensivo e quello difensivo
 di ciascun veicolo.
 Un tempo differenziati per veicolo, questi parametri sono oggi usati per
 rimappare il valore del danno causato e ricavare il numero di 
\emph on
orb 
\emph default
perduti e sono uguali per tutti.
\end_layout

\begin_layout Subsection
Armi e potenziamenti
\end_layout

\begin_layout Standard
La gestione delle armi e dei potenziamenti dei veicoli è affidata a 
\emph on
cinque 
\emph default
componenti diversi, alcuni dei quali sono associati al veicolo come il 
\emph on
Power Controller
\emph default
, altri ai 
\emph on
core
\emph default
 come il 
\emph on
Power-Up Collectable 
\emph default
ed altri a 
\emph on
game object 
\emph default
che rappresentano gli effetti di tali potenziamenti (Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:PowerUps"

\end_inset

)
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename C:/Users/raffa/Documents/Repo/OrbTail/Doc/Tesi/img/OrbTailPowerups.png
	lyxscale 20
	width 14cm

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset Argument 1
status open

\begin_layout Plain Layout
Gestione dei potenziamenti
\end_layout

\end_inset


\begin_inset CommandInset label
LatexCommand label
name "fig:PowerUps"

\end_inset

Gestione dei potenziamenti
\end_layout

\end_inset


\end_layout

\end_inset

.
\end_layout

\begin_layout Standard
Il 
\emph on
Power Controller 
\emph default
è un componente che si occupa di 
\emph on
collezionare 
\emph default
i 
\emph on
core 
\emph default
distribuiti sull'arena, in maniera analoga a quanto avviene per gli 
\emph on
orb
\emph default
.
 Ogni 
\emph on
core 
\emph default
usa un componente speciale, il 
\emph on
Power-Up Collectable
\emph default
, al fine di generare un potere casuale da associare al veicolo.
 Questo componente si occupa inoltre di gestire la parte estetica del 
\emph on
core 
\emph default
e delle logiche di attivazione e disattivazione temporizzate.
 I poteri sono modellati attraverso un componente 
\emph on
Power-Up
\emph default
 che ne contiene varie informazioni di base quali il numero massimo di utilizzi,
 il tempo minimo tra due utilizzi consecutivi (detto 
\emph on
cooldown
\emph default
) ed un riferimento ad un componente apposito che ne modella l'effetto una
 volta attivato: il 
\emph on
Power-Up Effect
\emph default
.
 Questo componente è associato ad un oggetto che viene creato in fase di
 attivazione del 
\emph on
Power-Up
\emph default
 e contiene le informazioni di base dell'effetto, quali la sua durata, il
 veicolo che lo 
\emph on
possiede
\emph default
 e il veicolo 
\emph on
bersaglio 
\emph default
(se presente).
 Questa classe è estesa attraverso opportune derivate, una per ogni potenziament
o o arma supportata.
 L'oggetto associato al 
\emph on
Power-Up Effect 
\emph default
contiene tutte le logiche associate al potenziamento e il suo aspetto visivo.
 Questo oggetto è 
\emph on
gerarchicamente
\emph default
 
\emph on
dipendente 
\emph default
dal veicolo per poteri che devono 
\begin_inset Quotes fld
\end_inset

seguire
\begin_inset Quotes frd
\end_inset

 graficamente gli spostamenti, quali ad esempio le barriere, oppure puó
 muoversi liberamente come nel caso di missili e proiettili.
 Una categoria particolare di 
\emph on
Power-Up Effect 
\emph default
è costituita dai 
\emph on
Power-Up Drop
\emph default
, speciali potenziamenti che, attivati, generano un oggetto di gioco all'interno
 dell'arena.
 Questi oggetti assegnano un effetto negativo (derivato dal componente 
\emph on
Power-Up Effect
\emph default
) ai veicoli che lo collezionano.
 Questi speciali effetti consentono di modellare potenziamenti quali 
\emph on
trappole 
\emph default
e 
\emph on
mine
\emph default
.
 L'uso di questa architettura permette di gestire in maniera molto efficiente
 un gran numero di potenziamenti.
 La configurazione di quest'ultimi avviene direttamente in editor e garantisce
 dei tempi d'iterazione molto rapidi durante il loro bilanciamento.
\end_layout

\begin_layout Subsection
Gestione degli input 
\begin_inset CommandInset label
LatexCommand label
name "subsec:Gestione-degli-input"

\end_inset


\end_layout

\begin_layout Standard
L'architettura alla base del sistema di input consente di gestire l'interazione
 utente in maniera completamente trasparente rispetto alle periferiche utilizzat
e e alla piattaforma su cui è eseguito il gioco.
 Il sistema si basa su un componente 
\emph on
Input Proxy,
\emph default
 di cui ogni veicolo ne possiede un'istanza, il quale astrae tutte le azioni
 eseguibili dall'utente o dall'
\emph on
intelligenza artificiale.
 
\emph default
Queste azioni comprendono l'
\emph on
accelerazione
\emph default
, l'
\emph on
azione di sterzo, 
\emph default
l'
\emph on
attivazione dei potenziamenti
\emph default
 e tutti gli input necessari per navigare nel menú.
 Questo componente è una 
\emph on
façade
\emph default
 usata sia dal 
\emph on
Movement Controller 
\emph default
che dal 
\emph on
Power Controller, 
\emph default
la quale si interfaccia a sua volta con oggetti che descrivono il sistema
 di input della particolare piattaforma su cui viene eseguita l'applicazione.
 Questi oggetti implementano un'interfaccia generica 
\emph on
IInput Broker 
\emph default
e comprendono il gestore degli input sulle piattaforme desktop 
\emph on
Desktop Input Broker, 
\emph default
mobile 
\emph on
Mobile Input Broker 
\emph default
e il componente che si occupa di gestire l'intelligenza artificiale 
\emph on
PlayerAI
\emph default
 (Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Input"

\end_inset

)
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename C:/Users/raffa/Documents/Repo/OrbTail/Doc/Tesi/img/OrbTailInput.png
	lyxscale 20
	width 14cm

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset Argument 1
status open

\begin_layout Plain Layout
Gestione degli input
\end_layout

\end_inset


\begin_inset CommandInset label
LatexCommand label
name "fig:Input"

\end_inset

Gestione degli input
\end_layout

\end_inset


\end_layout

\end_inset

.
 Il 
\emph on
Mobile Input Broker 
\emph default
si occupa di leggere lo stato dell'accelerometro del dispositivo 
\emph on
mobile 
\emph default
al fine di registrare le azioni di 
\emph on
accelerazione 
\emph default
e di 
\emph on
sterzo
\emph default
 e lo stato del touchscreen per l'utilizzo dei potenziamenti.
 Durante l'inizializzazione di ogni partita, questo componente 
\emph on
calibra 
\emph default
l'input relativo all'accelerometro in modo che si adatti all'inclinazione
 attuale del dispositivo: questa posizione viene usata come punto di riferimento
 per calcolare tutte le altre inclinazioni e di conseguenza le azioni utente.
 Il 
\emph on
Desktop Input Broker
\emph default
, invece, si affida a sua volta ad un oggetto 
\emph on
Input Manager 
\emph default
al fine di astrarre le azioni utente dalle periferiche utilizzate, quali
 
\emph on
tastiere
\emph default
 e 
\emph on
pad
\emph default
.
 L'applicazione prevede un 
\emph on
Input Manager 
\emph default
per ciascun utente locale
\emph on
.
 
\emph default
Le azioni sono gestite direttamente dal sistema di input di Unity, tuttavia
 è stato necessario aggiungere un livello di astrazione aggiuntivo in quanto
 quest'ultimo è stato giudicato inadeguato per le esigenze del progetto.
 Il sistema di input di Unity consente di registrare piú azioni alle quali
 sono associati in maniera esclusiva fino a due tasti oppure degli assi
 (come ad esempio gli 
\emph on
stick 
\emph default
dei 
\emph on
pad 
\emph default
o i 
\emph on
grilletti 
\emph default
posteriori), rendendo impossibile associare ad una singola azione piú periferich
e contemporaneamente.
 È inoltre impossibile rimappare delle azioni esistenti su 
\emph on
pad 
\emph default
diversi, pertanto è stato necessario duplicare le azioni per ciascuno dei
 
\emph on
quattro 
\emph default
pad supportati.
 L'oggetto 
\emph on
Input Manager 
\emph default
consente di usare l'indice dell'utente al fine di indicizzare le azioni
 opportune tra quelle registrate al sistema nativo di Unity.
 Il primo giocatore è inoltre l'unico a poter usare indipendentemente la
 tastiera o il pad.
 
\end_layout

\begin_layout Section
Architettura di rete
\end_layout

\begin_layout Standard
L'architettura di gioco di OrbTail é pensata per gestire in maniera uniforme
 tutte le modalitá e configurazioni supportate, evitando di creare classi
 apposite per gestire le modalitá a giocatore singolo, quelle multigiocatore
 locale e quelle multigiocatore 
\emph on
online.
 
\emph default
L'architettura di rete è di tipo 
\emph on
client-server
\emph default
 e uno dei dispositivi dei giocatori è usato come 
\emph on
host 
\emph default
per la partita.
 Dato il basso numero di giocatori coinvolti, questa soluzione è ottimale
 perchè garantisce un buona esperienza 
\emph on
online 
\emph default
evitando i costi associati ad un server dedicato.
 Il 
\emph on
server 
\emph default
si occupa di gestire tutti gli elementi di gioco quali 
\emph on
orb 
\emph default
e 
\emph on
core
\emph default
 e i veicoli gestiti dalla 
\emph on
IA, 
\emph default
laddove ogni 
\emph on
client 
\emph default
gestirá uno o piú veicoli associati ai giocatori locali (in caso di 
\emph on
multigiocatore splitscreen).
 
\emph default
Sebbene il dispositivo 
\emph on
host 
\emph default
sia contemporaneamente 
\emph on
server 
\emph default
e 
\emph on
client
\emph default
, le due parti sono gestite in maniera indipendente.
 L'
\emph on
host 
\emph default
in funzione di 
\emph on
client 
\emph default
richiede in ogni caso una connessione al 
\emph on
server 
\emph default
al fine di inviare comandi e riceverne aggiornamenti
\emph on
: 
\emph default
il sistema di rete di Unity provvederá a simulare le richieste di rete sulla
 stessa applicazione in maniera trasparente.
\end_layout

\begin_layout Standard
La sincronizzazione degli stati di gioco avviene secondo due possibili meccanism
i forniti da Unity: la 
\emph on
replicazione
\emph default
 e le 
\emph on
chiamate remote
\emph default
 (Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:NetArchitecture"

\end_inset

)
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename C:/Users/raffa/Documents/Repo/OrbTail/Doc/Tesi/img/OrbTailNetworking.png
	lyxscale 20
	width 14cm

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset Argument 1
status open

\begin_layout Plain Layout
Architettura di rete
\end_layout

\end_inset


\begin_inset CommandInset label
LatexCommand label
name "fig:NetArchitecture"

\end_inset

Architettura di rete
\end_layout

\end_inset


\end_layout

\end_inset

.
 Il primo di questi consente al server di propagare il valore di uno stato
 di gioco su tutti gli oggetti client costantemente.
 Questo metodo è particolarmente adatto per valori che cambiano molto rapidament
e di cui peró non è necessario che vi sia una forte corrispondenza tra la
 versione sul 
\emph on
server 
\emph default
e quella sul 
\emph on
client,
\emph default
 quali ad esempio la posizione dei veicoli ed il punteggio dei giocatori.
 Il 
\emph on
server
\emph default
 ha sempre 
\emph on
autoritá
\emph default
 sui valori sincronizzati in questo modo e pertanto non è possibile utilizzare
 questo meccanismo nel senso opposto al fine di inviare dati dal 
\emph on
client 
\emph default
al 
\emph on
server.
\end_layout

\begin_layout Standard
Il secondo meccanismo, noto col termine
\emph on
 
\emph default

\begin_inset Quotes fld
\end_inset

remote procedure call
\begin_inset Quotes frd
\end_inset

 (
\emph on
RPC
\emph default
)
\emph on
, 
\emph default
consente di chiamare un metodo di un oggetto su un'istanza remota di gioco.
 Unity ne fornisce due varianti, la prima è rappresentata dai 
\emph on
comandi
\emph default
 i quali sono usati per inviare un'azione dal 
\emph on
client
\emph default
 al 
\emph on
server
\emph default
, la seconda è rappresentata dalle 
\emph on
client RPC 
\emph default
le quali vengono inviate dal server e propagate su 
\emph on
tutti 
\emph default
i client.
 Questo metodo è adatto per eventi di sincronizzazione che avvengono di
 rado ma per i quali vi deve essere l'assoluta certezza che i 
\emph on
client 
\emph default
ne vengano notificati, come ad esempio gli eventi che determinano l'inizio
 o la fine di una partita.
\end_layout

\begin_layout Standard
Il paradigma fondamentale su cui si basa Unity consiste nell'inviare 
\emph on
comandi 
\emph default
dal client al server, attendere che questo ne verifichi la validitá aggiornando
 lo stato di gioco e quindi propagare quest'ultimo tramite 
\emph on
replicazione 
\emph default
oppure tramite 
\emph on
client RPC
\emph default
.
 Secondo questo paradigma, ignorando i tempi necessari per inviare i messaggi
 sulla rete, tutti i 
\emph on
client
\emph default
 osservano sempre lo stesso stato di gioco.
\end_layout

\begin_layout Standard
Ad ogni giocatore connesso ad una partita viene associato un particolare
 
\emph on
game object 
\emph default
che ne contiene i dati identificativi e ne rappresenta la volontá.
 Per ragioni di sicurezza è possibile inviare 
\emph on
comandi 
\emph default
al server solo attraverso di esso e solo se il giocatore locale ne ha l'
\emph on
autoritá
\emph default
, ovvero se il 
\emph on
game object 
\emph default
in questione rappresenta la sua identitá e non quella di un altro giocatore.
\end_layout

\begin_layout Subsection
Gestione della lobby 
\begin_inset CommandInset label
LatexCommand label
name "subsec:GestioneLobby"

\end_inset


\end_layout

\begin_layout Standard
Una 
\emph on
lobby 
\emph default
è una 
\emph on
stanza virtuale 
\emph default
a cui altri utenti online possono connettersi.
 Quest'ultima contiene le informazioni di configurazione della partita prima
 del suo avvio quali la modalitá di gioco e l'arena selezionata.
 Le 
\emph on
lobby
\emph default
 sono gestite attraverso un 
\emph on
singleton 
\emph default
derivato dalla classe di Unity 
\emph on
Network Lobby Manager
\emph default
, la quale astrae tutte le logiche di creazione o ricerca di una partita,
 connessione e disconnesione degli utenti e sincronizzazione della configurazion
e di gioco.
 Ogni giocatore connesso ad una 
\emph on
lobby 
\emph default
è associato ad un oggetto di tipo 
\emph on
Lobby Player
\emph default
, il quale viene usato sia per inviare comandi al 
\emph on
server 
\emph default
e sia per rappresentare i dati del giocatore, quali il suo indice nella
 partita, il veicolo scelto e le informazioni riguardanti la connessione.
\end_layout

\begin_layout Standard
Una volta che l'utente ha deciso la configurazione della partita, il 
\emph on
Lobby Manager
\emph default
 usa i servizi di 
\emph on
matchmaking 
\emph default
di Unity al fine di individuare 
\emph on
lobby 
\emph default
esistenti con configurazione compatibile.
 Questo servizio indicizza tutte le 
\emph on
lobby 
\emph default
pubbliche, esponendo varie informazioni quali i loro nomi, il numero massimo
 di giocatori, il numero di utenti attualmente connessi e tutte le informazioni
 necessarie per connettersi ad essa.
 Sebbene il sistema consente di associare a ciascuna 
\emph on
lobby 
\emph default
delle 
\emph on
metainformazioni 
\emph default
(come ad esempio la modalitá di gioco), un 
\emph on
bug 
\emph default
di Unity impedisce a quest'informazione di essere replicata correttamente,
 impedendone completamente il suo utilizzo.
 Per ovviare a questo inconveniente è stato deciso di usare il nome della
 
\emph on
lobby 
\emph default
per 
\emph on
codificare 
\emph default
le metainformazioni necessarie in formato CSV
\begin_inset Foot
status collapsed

\begin_layout Plain Layout
Il formato CSV (
\begin_inset Quotes fld
\end_inset

comma-separated values
\begin_inset Quotes frd
\end_inset

) codifica tutti i campi di una struttura in un'unica stringa in cui due
 campi consecutivi sono separati da un punto-e-virgola.
\end_layout

\end_inset

.
 La lista di 
\emph on
lobby 
\emph default
cosí ottenuta viene filtrata a seconda della configurazione dell'utente
 ed il sistema provvede a connettersi ad una qualsiasi tra quelle rimaste.
 Se il tentativo di connessione fallisce (come potrebbe capitare se, nel
 frattempo, la partita in quella lobby è giá iniziata) vengono effettuati
 tentativi di connessione addizionali sulle altre lobby fino ad un numero
 massimo configurabile.
 Se non è stato possibile individuare una 
\emph on
lobby 
\emph default
compatibile, il sistema provvede a crearne una nuova e a registrarla pubblicamen
te al servizio di 
\emph on
matchmaking 
\emph default
affinchè altri giocatori possano connettersi.
 Nel caso di partite a giocatore singolo le fasi di ricerca delle 
\emph on
lobby 
\emph default
e di registrazione al servizio di 
\emph on
matchmaking 
\emph default
vengono ignorate ma la 
\emph on
lobby 
\emph default
viene comunque creata.
 
\end_layout

\begin_layout Standard
Ogni volta che un giocatore entra in una 
\emph on
lobby
\emph default
, il 
\emph on
LobbyManager 
\emph default
crea un oggetto di tipo 
\emph on
Lobby Player 
\emph default
che lo rappresenta, replicando tutte le informazioni salienti agli altri
 giocatori in partita (quali l'indice del giocatore nella partita ed il
 veicolo scelto).
 Un utente puó abbandonare una 
\emph on
lobby 
\emph default
in qualsiasi momento.
\end_layout

\begin_layout Standard
Per procedere con l'avvio della partita, gli utenti connessi devono esplicitamen
te inviare un 
\emph on
comando 
\emph default
al server, dichiarando di essere 
\begin_inset Quotes fld
\end_inset

pronti
\begin_inset Quotes frd
\end_inset

.
 Quando l'ultimo di questi 
\emph on
comandi 
\emph default
viene ricevuto, il server 
\emph on
blocca 
\emph default
la partita pubblica (se presente) rimuovendola dal servizio di 
\emph on
matchmaking
\emph default
, impedendo ad altri giocatori di potersi connettere.
 A questo punto il 
\emph on
server 
\emph default
genera 
\emph on
Lobby Player 
\emph default
addizionali finchè il numero di partecipanti non diventa esattamente 
\emph on
quattro:
\emph default
 questi giocatori sono configurati per essere comandati dal sistema di 
\emph on
intelligenza artificiale
\emph default
.
 Dopo un breve conto alla rovescia, un'opportuna 
\emph on
client RPC
\emph default
 notifica i vari client dell'inizio della partita, iniziando il caricamento
 del livello corretto su tutti i dispositivi.
\end_layout

\begin_layout Standard
In una prima versione il sistema di creazione delle 
\emph on
lobby 
\emph default
era esplicito: l'utente poteva decidere se creare un nuovo match oppure
 se partecipare ad uno esistente.
 Questo tipo d'interazione è stato rivisto perchè giudicato obsoleto: nel
 caso in cui non vi fosse nessuna 
\emph on
lobby 
\emph default
disponibile, l'utente era costretto a ritornare al menú principale per crearne
 una e ció aumentava ingiustificatamente il numero di interazioni necessarie
 per entrare in partita.
 Sebbene i flussi di creazione di una paritita online ed offline sono identici,
 la selezione di una o dell'altra modalitá deve essere esplicitamente dichiarata
 dal giocatore all'inizio del flusso di gioco.
 Per questa iterazione era stato valutato un sistema che avrebbe permesso
 al giocatore di entrare in partita e lasciare che il sistema decidesse
 se avviare una partita online o offline (a seconda se vi fosse una connessione
 Internet o meno), tuttavia, a causa di tempi di sviluppo ridotti, questa
 funzionalitá è stata rimandata ad iterazioni future.
\end_layout

\begin_layout Subsection
Gestione della partita
\end_layout

\begin_layout Standard
La gestione dello stato di gioco è affidata ad un oggetto 
\emph on
Game Mode
\emph default
 il cui tipo, derivato dalla classe 
\emph on
Base Game Mode
\emph default
, dipende dalla modalitá di gioco selezionata (Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:GameModes"

\end_inset

)
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename C:/Users/raffa/Documents/Repo/OrbTail/Doc/Tesi/img/OrbTailGameModes.png
	lyxscale 20
	width 12cm

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset Argument 1
status open

\begin_layout Plain Layout
Modalita di gioco
\end_layout

\end_inset


\begin_inset CommandInset label
LatexCommand label
name "fig:GameModes"

\end_inset

Modalitá di gioco
\end_layout

\end_inset


\end_layout

\end_inset

.
 Questo oggetto descrive le regole di gioco e le condizioni di vittoria,
 gestendo al contempo il flusso di gara.
 Tra i suoi parametri di configurazione troviamo la durata massima della
 partita, il numero di punti guadagnati per 
\emph on
orb 
\emph default
collezionato, il numero di 
\emph on
orb 
\emph default
iniziali e cosí via.
 Lo stato di gioco è replicato internamente alla classe e notificato attraverso
 eventi al quale 
\emph on
osservatori
\emph default
, quali HUD e i veicoli, possono registrarsi e reagire.
 La classe base 
\emph on
Base Game Mode
\emph default
 contiene tutte le logiche condivise tra le varie modalitá, mentre le sue
 derivate ne possono estendere il comportamento implementando logiche specifiche
, come ad esempio il calcolo dei punti e la gestione dell'eliminazione dei
 partecipanti.
 Questo oggetto viene creato dal 
\emph on
server 
\emph default
in fase di creazione della 
\emph on
lobby
\emph default
 e replicato su tutti i client e rimane in vita per tutta la durata della
 partita.
 La gestione degli eventi di gioco quali l'acquisizione o la perdita di
 
\emph on
orb 
\emph default
e 
\emph on
potenziamenti, 
\emph default
è gestita direttamente dal 
\emph on
server
\emph default
 e i 
\emph on
client
\emph default
 ne subiscono passivamente gli esiti attraverso opportuni eventi propagati
 tramite 
\emph on
client RPC.

\emph default
 Gli stati di gioco 
\emph on
non critici,
\emph default
 quali tempo rimanente e punteggi, sono invece sia calcolati sul server
 e 
\emph on
replicati
\emph default
 e sia simulati da tutti i 
\emph on
client 
\emph default
in locale.
 Questa strategia consente a 
\emph on
client
\emph default
 di osservare sempre una situazione verosimile anche in caso di perdita
 temporanea della connettivitá
\emph on
.
\end_layout

\begin_layout Standard
Ciascuna partita è strutturata in 
\emph on
quattro 
\emph default
fasi differenti che si susseguono una dopo l'altra fino al termine (Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:MatchFlow"

\end_inset

)
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename C:/Users/raffa/Documents/Repo/OrbTail/Doc/Tesi/img/OrbTailNetFlow.png
	lyxscale 20
	width 14cm

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset Argument 1
status open

\begin_layout Plain Layout
Flusso di gara
\end_layout

\end_inset


\begin_inset CommandInset label
LatexCommand label
name "fig:MatchFlow"

\end_inset

Flusso di gara
\end_layout

\end_inset


\end_layout

\end_inset

.
 Durante la fase iniziale il 
\emph on
server 
\emph default
mette i giocatori in attesa, fintanto che tutti partecipanti abbiano caricato
 la mappa.
 Ogni volta che un dispositivo ha caricato la mappa corretta, il 
\emph on
server
\emph default
 provvede a creare il suo veicolo e a replicarlo: in questo istante il controllo
 del giocatore viene 
\emph on
trasferito 
\emph default
dal 
\emph on
Lobby Player 
\emph default
al 
\emph on
veicolo
\emph default
, in modo che quest'ultimo possa essere usato per inviare 
\emph on
comandi 
\emph default
al 
\emph on
server
\emph default
 durante la partita.
 L'oggetto 
\emph on
Lobby Player 
\emph default
viene preservato in modo da poter contenere informazioni associate al giocatore,
 quali ad esempio il suo 
\emph on
punteggio.

\emph default
 Sull'istanza locale di gioco, l'oggetto 
\emph on
Base Game Mode 
\emph default
determina la creazione di tutti gli oggetti necessari al giocatore che non
 devono essere replicati, quali ad esempio il 
\emph on
controllore della camera
\emph default
 e della 
\emph on
HUD
\emph default
.
 Durante questa breve fase di sincronizzazione, il gioco mostra una breve
 guida che descrive le regole di gioco e tutti i potenziamenti disponibili.
 Questo stratagemma consente sia di ridurre il tempo di attesa percepito
 e sia di informare l'utente delle regole specifiche di gioco.
 Una volta che tutti i partecipanti hanno congedato questa schermata, il
 
\emph on
server 
\emph default
procede con la fase successiva di 
\emph on
conto alla rovescia
\emph default
, lasciando che gli utenti possano prepararsi alla sfida.
 La fase successiva è quella di gioco e dura fintanto che il cronometro
 di gara non scende a 
\emph on
zero
\emph default
.
 In questa fase il 
\emph on
server 
\emph default
si occupa di gestire gli scontri trai veicoli e la collezione di oggetti
 e potenziamenti e l'attivazione di quest'ultimi.
 Gli eventi associati a queste gestioni sono propagati attraverso delle
 
\emph on
client RPC
\emph default
.
 La gestione del movimento fa invece eccezione: gli oggetti che rappresentano
 i veicoli dei giocatori sono creati sui rispettivi 
\emph on
client 
\emph default
i quali ne esercitano l'
\emph on
autoritá
\emph default
 determinandone la posizione e la gestione degli input.
 In questo caso il 
\emph on
server 
\emph default
viene usato semplicemente per propagare l'informazione agli altri dispositivi.
 La modalitá di gioco 
\begin_inset Quotes fld
\end_inset

eliminazione
\begin_inset Quotes frd
\end_inset

 prevede inoltre uno stato aggiuntivo che viene abilitato quando il giocatore
 locale viene eliminato dalla partita: in questo stato il giocatore fa da
 
\emph on
spettatore
\emph default
, controllando una camera che puó inquadrare i veicoli dei giocatori rimasti
 in partita e ciclando tra di essi fino a fine partita.
 In questo stato, l'oggetto usato dal giocatore per inviare comandi al 
\emph on
server 
\emph default
viene rimpiazzato con il 
\emph on
controllore della camera
\emph default
 
\emph on
spettatore
\emph default
 e il veicolo viene distrutto.
 Al termine del tempo massimo di partita, o quando tutti i giocatori sono
 stati eliminati, il sistema si porta nella fase finale in cui viene dichiarato
 il vincitore a seconda di condizioni specifiche della modalitá di gioco.
 In questa fase è possibile consultare l'esito della partita e abbandonarla,
 ritornando al al menú principale.
 L'abbandono di una partita causa la distruzione completa di tutti gli oggetti
 coinvolti, quali la 
\emph on
lobby
\emph default
, i 
\emph on
veicoli
\emph default
, il 
\emph on
Game Mode 
\emph default
e il 
\emph on
Lobby Manager
\emph default
.
\end_layout

\begin_layout Standard
La gestione delle modalitá online ed offline è stata uniformata in modo
 da seguire lo stesso flusso e basarsi sulle stesse classi, evitando gestioni
 specifiche.
 Secondo quest'ottica le modalitá 
\emph on
offline 
\emph default
sono gestite come fossero delle partite 
\emph on
online 
\emph default
in cui il server è l'applicazione stessa ed in cui vi sono solo giocatori
 locali e veicoli gestiti dalla 
\emph on
IA
\emph default
.
 Una limitazione di questo approccio è data dal fatto che in modalitá 
\emph on
online
\emph default
 il motore non supporta la replicazione di oggetti giá posizionati in scena
 e si è pertanto costretti a crearli dinamicamente.
 Per ovviare a questa limitazione è stato creato un 
\emph on
game object 
\emph default
apposito, detto 
\emph on
Network Spawner
\emph default
, il quale puó essere posizionato direttamente in scena e configurato con
 un riferimento ad un'altro 
\emph on
game object
\emph default
.
 Durante la creazione del 
\emph on
server 
\emph default
questo 
\emph on
script
\emph default
 si attiva, causando la generazione del 
\emph on
game object 
\emph default
replicato su tutti i client.
 Questo oggetto è stato usato principalmente per gestire gli 
\emph on
orb 
\emph default
e i 
\emph on
core 
\emph default
in quanto era necessario che le loro posizioni fossero configurabili manualmente
 su tutte le arene.
\end_layout

\begin_layout Section
Intelligenza artificiale
\end_layout

\begin_layout Standard
L'
\emph on
intelligenza artificiale
\emph default
 di gioco è gestita attraverso un singolo componente 
\emph on
Player AI
\emph default
 che, attivato su un qualsiasi veicolo, ne gestisce direttamente gli input,
 quali 
\emph on
accelerazione
\emph default
 ed 
\emph on
azione di sterzo
\emph default
 (vedi 
\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:Gestione-degli-input"

\end_inset

).
 Questo componente è generato automaticamente durante l'inizializzazione
 del componente 
\emph on
Ship
\emph default
 se il giocatore associato ad esso è governato dalla 
\emph on
IA
\emph default
.
\end_layout

\begin_layout Standard
Il sistema di 
\emph on
intelligenza artificiale
\emph default
 è molto semplice e si basa su 
\emph on
tre
\emph default
 strategie diverse che vengono attivate in funzione di eventi di gioco particola
ri (Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:AI"

\end_inset

)
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename C:/Users/raffa/Documents/Repo/OrbTail/Doc/Tesi/img/OrbTailAI.png
	lyxscale 20
	width 14cm

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset Argument 1
status open

\begin_layout Plain Layout
Intelligenza artificiale - Strategie
\end_layout

\end_inset


\begin_inset CommandInset label
LatexCommand label
name "fig:AI"

\end_inset

Strategie adottate dall'intelligenza artificiale
\end_layout

\end_inset


\end_layout

\end_inset

.
 Nella forma piú semplice, ciascuna strategia si basa sul raggiungimento
 di un 
\emph on
game object 
\emph default
bersaglio il quale, a seconda della strategia attualmente attiva, corrisponde
 ad un 
\emph on
orb
\emph default
, un 
\emph on
core
\emph default
, un 
\emph on
veicolo avversario 
\emph default
oppure un 
\emph on
punto di controllo
\emph default
.
 Una volta determinato l'oggetto da raggiungere, il sistema usa la direzione
 relativa 
\begin_inset Formula $\overrightarrow{d_{rel}}$
\end_inset

 di quest'ultimo rispetto al veicolo per calcolare i valori di 
\emph on
accelerazione 
\begin_inset Formula $a_{i}$
\end_inset

 
\emph default
e di 
\emph on
azione di sterzo
\emph default
 
\begin_inset Formula $s_{i}$
\end_inset

:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
\overrightarrow{d_{rel}}=\overrightarrow{p_{b}}-\overrightarrow{p_{v}}
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
s_{i}=\overrightarrow{u}\cdot(\overrightarrow{f}\times\overrightarrow{d_{rel}})\cdot K_{s}
\]

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
a_{i}=1-|s_{i}|
\]

\end_inset


\end_layout

\begin_layout Standard
dove 
\begin_inset Formula $\overrightarrow{u}$
\end_inset

 e 
\begin_inset Formula $\overrightarrow{f}$
\end_inset

 sono i versori che rappresentano rispettivamente la direzione longitudinale
 e quella sagittale del veicolo, 
\begin_inset Formula $\overrightarrow{p_{b}}$
\end_inset

 e 
\begin_inset Formula $\overrightarrow{p_{v}}$
\end_inset

 sono invece la posizione dell'oggetto bersaglio e quella del veicolo stesso.
 Il calcolo dell'
\emph on
azione di sterzo 
\begin_inset Formula $s_{i}$
\end_inset


\emph default
 permette al veicolo di sterzare in maniera proporzionale alla sua differenza
 angolare rispetto al suo obiettivo.
 
\begin_inset Formula $K_{s}$
\end_inset

 è un fattore moltiplicativo che permette di accentuare o diminuire questa
 azione ed è liberamente configurabile.
 L'azione di 
\emph on
accelerazione 
\emph default
è calcolata sulla base del valore di 
\emph on
sterzo 
\emph default
e, sebbene impedisce che il veicolo comandato dalla 
\emph on
IA 
\emph default
possa accelerare e sterzare al massimo in un dato istante, garantisce un
 controllo maggiore e una strategia piú consistente, impedendo allo stesso
 tempo che il veicolo possa collidere con ostacoli durante un cambio di
 direzione.
\end_layout

\begin_layout Standard
La strategia fondamentale
\emph on
 
\emph default
è quella dedicata all'
\emph on
esplorazione
\emph default
 e consente al veicolo di muoversi liberamente nell'arena al fine di individuare
 oggetti da collezionare o veicoli da aggredire.
 Questa strategia si basa sul raggiungimento di particolari 
\emph on
punti di controllo 
\emph default
invisibili posizionati nell'arena e selezionati in maniera 
\emph on
casuale
\emph default
.
 L'intelligenza artificiale usa un componente aggiuntivo, l'
\emph on
AI Field-of-View
\emph default
, che ne modella il suo campo visivo.
 Ogni volta che un oggetto entra all'interno del campo visivo, il sistema
 ne determina la sua 
\emph on
utilitá
\emph default
 e stabilisce se raccoglierlo (in caso di 
\emph on
orb 
\emph default
o 
\emph on
core
\emph default
) o aggredirlo (in caso di un 
\emph on
veicolo avversario
\emph default
), attivando una strategia opportuna.
 Questi oggetti possono causare un cambio di strategia solo se il veicolo
 è in fase 
\emph on
esplorativa
\emph default
.
 Se l'oggetto bersaglio dovesse finire fuori dal campo visivo dell'intelligenza
 artificiale, il sistema annulla qualsiasi strategia in corso, riabilitando
 quella dedicata all'
\emph on
esplorazione
\emph default
 dell'arena
\emph on
.
 
\emph default
La strategia di collezione degli oggetti è molto semplice, in quanto consiste
 nel calcolare un valore di input tale da permettere il raggiungimento dell'ogge
tto nel minor tempo possibile.
 La strategia 
\emph on
offensiva 
\emph default
invece si sviluppa in due fasi.
 Nella prima viene determinata l'
\emph on
utilitá 
\emph default
del veicolo da aggredire, ignorando tutti quelli con un numero di 
\emph on
orb 
\emph default
esiguo.
 Una volta che un 
\emph on
veicolo
\emph default
 viene selezionato come bersaglio
\emph on
, 
\emph default
l'
\emph on
AI 
\emph default
cerca di collidervi alla massima velocitá (in maniera analoga a quanto avviene
 durante la collezione degli oggetti) e, ad impatto avvenuto, determina
 se vi è ancora necessitá di proseguire l'attacco (valutando nuovamente
 il numero di 
\emph on
orb 
\emph default
posseduti).
 In caso positivo, l'
\emph on
AI 
\emph default
cerca di allontanarsi dal veicolo avversario per un certo periodo di tempo
 selezionato in un intervallo casuale di pochi secondi, dopodichè procede
 nuovamente con la fase di 
\emph on
attacco
\emph default
.
 In caso negativo, l'
\emph on
AI 
\emph default
si porta in fase 
\emph on
esplorativa.
 
\emph default
Per impedire che un'
\emph on
AI 
\emph default
possa accanirsi contro un veicolo avversario, l'intera strategia 
\emph on
aggressiva 
\emph default
è temporizzata e viene disabilitata dopo un tempo casuale, portando l'
\emph on
AI 
\emph default
nuovamente in fase 
\emph on
esplorativa
\emph default
.
\end_layout

\begin_layout Section
Multigiocatore locale
\end_layout

\begin_layout Standard
OrbTail offre un sistema in grado di gestire in maniera uniforme partite
 con un numero di giocatori locali compreso tra 
\emph on
uno 
\emph default
e 
\emph on
quattro
\emph default
.
 Le modalitá a giocatore singolo o multigiocatore online vengono gestite
 attraverso lo stesso sistema e non richiedono pertanto supporti specifici.
 In fase di selezione del veicolo, il gioco consente ai partecipanti di
 unirsi alla partita mediante la pressione di un tasto sul 
\emph on
pad
\emph default
 e selezionare un proprio veicolo.
 Ciascuna selezione è contenuta all'interno di un componente di tipo 
\emph on
Player Configuration
\emph default
, il quale contiene l'indice del 
\emph on
giocatore
\emph default
 
\emph on
locale
\emph default
, il veicolo selezionato e l'identitá del giocatore (umano o comandato dall'
\emph on
intelligenza artificiale
\emph default
).
 In fase di creazione della 
\emph on
lobby, 
\emph default
il 
\emph on
Lobby Manager 
\emph default
controlla il numero di 
\emph on
Player Configuration 
\emph default
presenti e crea un 
\emph on
Lobby Player 
\emph default
per ciascuno di essi.
 Questo meccanismo è inoltre utilizzato per l'aggiunta di giocatori comandati
 dall
\emph on
'intelligenza artificiale
\emph default
 (vedi 
\begin_inset CommandInset ref
LatexCommand ref
reference "subsec:GestioneLobby"

\end_inset

).
 Ciascun 
\emph on
Lobby Player 
\emph default
legge i dati presenti nella configurazione del giocatore e ne propaga lo
 stato sulla rete (Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:LocalMultiplayer"

\end_inset

)
\begin_inset Float figure
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename C:/Users/raffa/Documents/Repo/OrbTail/Doc/Tesi/img/OrbTailLocalMultiplayer.png
	lyxscale 20
	width 9cm

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset Argument 1
status open

\begin_layout Plain Layout
Gestione multigiocatore locale
\end_layout

\end_inset


\begin_inset CommandInset label
LatexCommand label
name "fig:LocalMultiplayer"

\end_inset

Gestione multigiocatore locale
\end_layout

\end_inset


\end_layout

\end_inset

.
\end_layout

\begin_layout Standard
Durante l'inizializzazione della partita, il 
\emph on
Base Game Mode
\emph default
 crea i 
\emph on
controllori delle camere 
\emph default
per ciascuno dei giocatori umani, associando ad essi il 
\emph on
Lobby Player 
\emph default
corretto.
 La gestione della telecamera di ciascun giocatore è affidata al componente
 
\emph on
Follow Camera,
\emph default
 il quale si occupa di 
\begin_inset Quotes fld
\end_inset

inseguire
\begin_inset Quotes frd
\end_inset

 il veicolo, e al componente 
\emph on
Camera, 
\emph default
messo a disposizione da Unity, il quale si occupa di gestire il 
\emph on
rendering
\begin_inset Foot
status collapsed

\begin_layout Plain Layout
In computer grafica, il 
\emph on
rendering 
\emph default
è il processo di generazione un'immagine a partire da una rappresentazione
 matematica di una scena tridimensionale.
\end_layout

\end_inset


\emph default
.
 Quando il sistema associa il 
\emph on
Lobby Player 
\emph default
alla 
\emph on
Follow Camera
\emph default
, quest'ultimo confronta l'indice del giocatore locale col numero totale
 di giocatori locali in partita e configura il 
\emph on
viewport
\begin_inset Foot
status collapsed

\begin_layout Plain Layout
In computer grafica, il 
\emph on
viewport 
\emph default
della telecamera rappresenta la porzione di schermo su cui viene renderizzata
 la scena inquadrata da quest'ultima.
 Solitamente il 
\emph on
viewport 
\emph default
copre l'intero schermo, tuttavia è possibile specificare una porzione piú
 piccola al fine di renderizzare i punti di vista di piú camere.
\end_layout

\end_inset

 
\emph default
della 
\emph on
Camera 
\emph default
di conseguenza (Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:Camera"

\end_inset

)
\begin_inset Float figure
placement !h
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename C:/Users/raffa/Documents/Repo/OrbTail/Doc/Tesi/img/OrbTailCamera.png
	lyxscale 20
	width 12cm

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset Argument 1
status open

\begin_layout Plain Layout
Gestione telecamera
\end_layout

\end_inset


\begin_inset CommandInset label
LatexCommand label
name "fig:Camera"

\end_inset

Gestione telecamera
\end_layout

\end_inset


\end_layout

\end_inset

.
 Nel caso in cui vi sia un solo giocatore, il sistema assegna l'intero schermo;
 con piú giocatori lo schermo viene diviso verticalmente (con 
\emph on
due 
\emph default
giocatori locali) o in quadranti (con 
\emph on
quattro 
\emph default
giocatori).
 La gestione di un numero di giocatori locali pari a 
\emph on
tre 
\emph default
fa invece eccezione.
 Originariamente era stato valutato di suddividere lo schermo in quadranti
 e lasciare uno di questi vuoto, tuttavia l'effetto non risultava piacevole
 e pertanto è stato deciso di suddividere in maniera asimmetrica lo schermo,
 assegnando una metá al primo giocatore e lasciando che gli altri due si
 spartissero l'altra metá (Fig.
 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:OrbTailSplitScreen"

\end_inset

)
\begin_inset Float figure
placement !h
wide false
sideways false
status collapsed

\begin_layout Plain Layout
\align center
\begin_inset Graphics
	filename C:/Users/raffa/Documents/Repo/OrbTail/Doc/Tesi/img/splitscreen.PNG
	lyxscale 20
	width 14cm

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Caption Standard

\begin_layout Plain Layout
\begin_inset Argument 1
status open

\begin_layout Plain Layout
Splitscreen
\end_layout

\end_inset


\begin_inset CommandInset label
LatexCommand label
name "fig:OrbTailSplitScreen"

\end_inset

Splitscreen
\end_layout

\end_inset


\end_layout

\end_inset

.
\end_layout

\begin_layout Standard
L'introduzione della modalitá 
\emph on
splitscreen
\emph default
 ha inoltre richiesto la suddivisione dell'interfaccia grafica in due: una
 dedicata alle informazioni di gioco quali il 
\emph on
cronometro di gara
\emph default
 e i 
\emph on
punteggi, 
\emph default
disegnata a tutto schermo,
\emph on
 
\emph default
e una dedicata alla visualizzazione delle informazioni di ciascun giocatore
 locale, quali ad esempio il 
\emph on
potenziamento 
\emph default
attivo, disegnata nel quadrante opportuno.
\end_layout

\begin_layout Standard
Il gioco non usa il sistema di interfaccia utente messo a disposizione da
 Unity ma si basa su un sistema di pannelli tridimensionali che seguono
 il veicolo.
 Questa gestione è affidata al componente 
\emph on
HUD Handler 
\emph default
e permette di ottenere un'interfaccia mobile dotata di un certo grado di
 libertá ed inerzia.
 Questi pannelli utilizzano componenti come il 
\emph on
Text Mesh, 
\emph default
che consente di generare del testo tridimensionale nello spazio, e lo 
\emph on
Sprite Renderer
\emph default
, il quale permette di mostrare immagini.
 L'introduzione di piú punti di vista costituiti dalle diverse camere, ha
 inoltre introdotto una problematica altrimenti inesistente: ognuno puó
 vedere la rappresentazione tridimensionale della 
\emph on
HUD 
\emph default
di ogni altro giocatore in prossimitá del veicolo di quest'ultimo.
 Per ovviare a questo inconveniente ci si è affidati al sistema di 
\emph on
layer 
\emph default
di Unity.
 Un 
\emph on
layer 
\emph default
non è altro che un nome simbolico che puó essere associato ad uno o piú
 oggetti di gioco e consente a quest'ultimi di essere 
\emph on
nascosti 
\emph default
dal rendering di determinate telecamere.
 L'
\emph on
HUD 
\emph default
di ogni giocatore è assegnata ad uno di 
\emph on
quattro 
\emph default
layer, uno per ogni giocatore locale.

\emph on
 
\emph default
La camera di ciascun giocatore è configurata per renderizzare solo l'HUD
 del giocatore opportuno e nascondere tutte le altre.
\end_layout

\begin_layout Standard
Durante lo sviluppo delle modalitá splitscreen, ci si è imbattuti in una
 grave limitazione di Unity, ovvero la mancanza di supporto per 
\emph on
Audio Listener 
\emph default
multipli.
 Questi componenti sono usati per modellare la posizione virtuale dell'ascoltato
re nello spazio, al fine di determinare la resa degli effetti sonori spaziali,
 quali esplosioni e il motore dei veicoli.
 Sebbene esistano diversi plugin a pagamento che possono essere usati per
 ovviare a questo inconveniente, è stato deciso di non usarne nessuno, sia
 per mancanza di tempo e sia perchè le meccaniche di gioco non si basano
 sul corretto uso dell'audio.
 Come soluzione temporanea sono stati disabilitati gli 
\emph on
Audio Listener 
\emph default
dei giocatori ad eccezione del primo e si è rimandato lo sviluppo di una
 possibile soluzione ad iterazioni successive del progetto.
\end_layout

\end_body
\end_document
